/*! Codethemer 0.0.1 2013-05-01 21:44 */
var App,console,Nav;host=location.protocol+"//"+location.host+"/",head.js(host+"js/_lib/mootools/core.js"),head.js(host+"js/_lib/mootools/more.js"),head.js(host+"js/_lib/image-hd.js"),head.js(host+"js/_lib/spin.min.js"),head.ready(function(){App.init(),console.log("hello")}),App={debug:!0,log:function(e){"use strict";console!==void 0&&this.debug===!0&&console.log(e)},init:function(){App.Nav.init()}},Location={protocol:location.protocol,host:location.host,url:this.host,path:location.pathname,current:function(){return this.segment(1)},segment:function(e){var t=location.pathname.split("/");return t=t[e],t!==void 0?t:""},page:function(){"use strict";var e=location.pathname.split("/");return e.slice(-1)[0]}},head.ready(function(){Location.current()}),App.Nav={html:{tabClass:"ul.tabs",closeBtnImg:Location.url+"img/icons/close-btn.png",closeBtnClass:"tab-close",emptyPage:Location.url+"render/empty"},bind:function(){var e=this;if($$("li.file-name").addEvent("click",function(){console.log($(this).get("html")),e.openPage($(this).get("key"),$(this).get("html").split(" ").join(""))}),$$("ul.tabs li").each(function(e){$(e).addEvent("click",function(){})}),"render"===Location.segment(1)){var t=$(Location.segment(2));t&&t.addClass("active")}$$(".folder-open").addEvent("click",function(){e.folderHide(this)}),$$(".folder").addEvent("click",function(){e.folderShow(this)})},fileList:function(e){$("open-files").getChildren().each(function(){var t=new Element("li",{id:e,href:Location.url+"render/"+e});$("open-files").adopt(t)}),$("open-files").adopt(li),App.log("hide open files")},folderHide:function(e){e=$(e),e.addClass("folder"),e.removeClass("folder-open"),e.removeEvents(),e.getSiblings(".file-name").each(function(e){$(e).hide()}),$(e).addEvent("click",function(){App.Nav.folderShow(e)}),App.log("close folder")},folderShow:function(e){e=$(e),e.removeClass("folder"),e.addClass("folder-open"),e.removeEvents(),e.getSiblings(".file-name").each(function(e){$(e).show()}),$(e).addEvent("click",function(){App.Nav.folderHide(e)}),App.log("open folder")},init:function(){this.bind(),this.openPages()},setPages:function(){if(null!==Storage.get("pages")){var e,t=[];$$("ul.tabs li").each(function(o){e=Array($(o).get("key")),t.append(e)}),Storage.set("pages",t)}var o=new Element("li",{html:name,id:key,href:Location.url+"render/"+key});$$("ul.tabs").adopt(o)},openPage:function(e,t){var o=Storage.get("pages");null!==o&&"undefined"==typeof page&&-1===o.indexOf(e)?(console.log(o.indexOf(e)),App.log("adding "+t+" to page list"),Storage.set("pages",o+","+e+":"+t),this.tabCreate(e,t),this.fileAdd(e,t)):null===o&&(App.log("opening "+t+". no other files open."),Storage.set("pages",e+":"+t),this.tabCreate(e,t),this.fileAdd(e,t)),location.href=Location.url+"render/"+e},openPages:function(){var e,t,o=this,n=Storage.get("pages");null!==n&&(n=n.split(","),n.each(function(n){n=n.split(":"),e=n[0],t=n[1],o.tabCreate(e,t),o.fileAdd(e,t)}))},closePage:function(e){var t=Storage.get("pages");-1!==t.indexOf(","+e)?(App.log("Close page: "+e),Storage.set("pages",t.split(","+e).join(""))):-1!==t.indexOf(e+",")&&(App.log("Close page: "+e),Storage.set("pages",t.split(e+",").join(""))),""===Storage.get("pages")&&Storage.remove("pages")},tabCreate:function(e,t){App.log("open tab: "+t);var o=this,n=new Element("li",{id:e,href:Location.url+"render/"+e}),a=new Element("img",{src:o.html.closeBtnImg,id:e+"-img"});a.addEvent("click",function(n){console.log(n.target),o.tabDestroy(e,t),o.fileRemove(e,t)}),a.addClass(this.html.closeBtnClass),n.addEvent("click",function(n){0===$(n.target).get("class").indexOf(o.html.closeBtnClass)?o.tabDestroy(e,t):location.href=Location.url+"render/"+e}),$(n).adopt(a),$(n).set("html",$(n).get("html")+t),$$(this.html.tabClass).adopt(n)},fileAdd:function(e,t){var o=new Element("li",{id:e+"-open-file",html:t,href:Location.url+"render/"+e});o.addClass("file-name"),o.addClass("tab1"),$("open-files").adopt(o)},fileRemove:function(e){$(e+"-open-file").destroy()},tabDestroy:function(e,t){App.log("close tab: "+e);var o=e+":"+t;pages=Storage.get("pages"),pages=pages.split(","+o).join(""),pages=pages.split(o+",").join(""),pages=pages.split(o).join(""),last=pages.split(",").getLast(),last=last.split(":"),last=last[0],Storage.set("pages",pages),""===Storage.get("pages")&&Storage.remove("pages"),$(e).destroy(),location.href=void 0===typeof page||null===pages||""===pages?this.html.emptyPage:Location.url+"render/"+last}},function(){var e=this.Cookie={};e.dispose=function(e){var t=new Date,o="",n=3;t.setDate(t.getDate()-n);var o=escape(o)+(null==n?"":"; expires="+t.toUTCString());document.cookie=e+"="+o},e.read=function(e){var t="",o=e+"=";return document.cookie.length>0&&(offset=document.cookie.indexOf(o),-1!=offset&&(offset+=o.length,end=document.cookie.indexOf(";",offset),-1==end&&(end=document.cookie.length),t=unescape(document.cookie.substring(offset,end)))),t},e.write=function(e,t,o){var n="",a="";null!=o&&(o=o.toLowerCase(),a=o.split(" "),a=a[0],o.indexOf("hours")>0||o.indexOf("hrs")>0||o.indexOf("hour")>0||o.indexOf("hr")>0?n=new Date((new Date).getTime()+36e5*a):(o.indexOf("days")>0||o.indexOf("day")>0)&&(n=new Date((new Date).getTime()+24*36e5*a)),n="; expires="+n.toGMTString(),document.cookie=e+"="+escape(t)+n)};var t=this.Storage={method:"set",name:"null",value:"null",isAvailable:!1,expiration:"30 days"};t.check=function(){localStorage.getItem("storageTest")?this.isAvailable=!0:(localStorage.setItem("storageTest",!0),localStorage.getItem("storageTest")&&(this.isAvailable=!0,localStorage.removeItem("storageTest")))},t.clear=function(){this.storage===!0&&localStorage.clear()},t.get=function(e){return this.isAvailable===!0?localStorage.getItem(e):cookie.read(e)},t.remove=function(e){this.isAvailable===!0&&localStorage.removeItem(e)},t.set=function(t,o){this.isAvailable===!0?localStorage.setItem(t,o):e.write(t,o,this.expiration)},t.check()}();